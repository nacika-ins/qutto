<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Qutto | AWS Lambda backed url shortener</title>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">
  <link href='https://fonts.googleapis.com/css?family=Lato:300,700,900' rel='stylesheet' type='text/css'>
  <style>
    h1 { font-family: 'Lato', sans-serif; font-weight: 700; font-size: 60px;}
    p.lead { font-family: 'Lato', sans-serif; font-weight: 300; font-size: 50px;}
    .container { margin-top: 30px; }
    .shorten-url { font-size: 30px; }
    .js--hide { display: none; }
  </style>
</head>
<body>

  <div class="container">

    <div class="starter-template">
      <h1>Qutto</h1>
      <p class="lead">AWS Lambda backed URL shortener.</p>
    </div>

    <div class="row">
      <div class="col-lg-6">
        <h2>Try Demo</h2>
        <div class="input-group input-group-lg">
          <input type="text" class="form-control" id="js--input--url" placeholder="https://github.com/toyamarinyon/qutto">
          <span class="input-group-btn">
            <button class="btn btn-primary" type="button" id="js--trigger--shorten">Shorten!</button>
          </span>
        </div>
      </div>
    </div>
    <div class="row js--hide" id="js--shorten-url-block">
      <div class="col-lg-6">
        <h2>Shorten URL</h2>
        <p class="shorten-url"><a href="#" id="js--shorten-url-preview" data-template="https://yourdomain/{{shorten}}"></a></p>
      </div>
    </div>

  </div>
  <script src="//code.jquery.com/jquery-2.1.4.min.js"></script>
  <script>
  $(function() {
    var shortable = true;
    var $triggerShorten = $('#js--trigger--shorten');
    $triggerShorten.on('click', function(event) {
      event.preventDefault();
      if ( ! shortable ) {
        return false;
      }
      shortable = false;
      $triggerShorten.prop("disabled", true);
      $triggerShorten.html("Processing");
      var data = {url: $('#js--input--url').val()};
      $.ajax({
        url: "https://5sbivlbdhf.execute-api.ap-northeast-1.amazonaws.com/prod/shorten",
        contentType: "application/json",
        dataType: "json",
        data: JSON.stringify(data),
        method: "POST",
        success: function(data, textStatus, jqXHR) {
          var $shortenUrlPreview = $("#js--shorten-url-preview");
          var template = $shortenUrlPreview.data("template");
          var preview = template.replace("{{shorten}}", data.shorten);
          $shortenUrlPreview.html(preview);
          $("#js--shorten-url-block").slideDown();
          shortable = true;
          $triggerShorten.prop("disabled", false);
          $triggerShorten.html("Shorten!");
        }
      });
    });
  });
  </script>
</body>
</html>
